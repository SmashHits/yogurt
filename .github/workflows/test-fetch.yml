name: Test YouTube Fetchers

on:
  workflow_dispatch: # manual run button

permissions:
  contents: write

jobs:
  test_fetchers:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install

      - name: Set env
        run: |
          echo "YOUTUBE_CLIENT_ID=${{ secrets.YOUTUBE_CLIENT_ID }}" >> $GITHUB_ENV
          echo "YOUTUBE_CLIENT_SECRET=${{ secrets.YOUTUBE_CLIENT_SECRET }}" >> $GITHUB_ENV
          echo "YOUTUBE_REFRESH_TOKEN=${{ secrets.YOUTUBE_REFRESH_TOKEN }}" >> $GITHUB_ENV
          echo "CHANNEL_ID=${{ secrets.CHANNEL_ID }}" >> $GITHUB_ENV

      - name: Run fetchSubs
        run: node src/fetchSubs.js

      - name: Run fetchComments
        run: node src/fetchComments.js

      - name: Show players.json
        run: |
          echo "---- players.json ----"
          cat players.json
